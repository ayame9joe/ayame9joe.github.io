<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Nick Balestra - Classes and Instantiation Patterns in javaScript</title>
  <link rel="shortcut icon" href="/assets/images/favicon.png">
  <link rel="stylesheet" href="/assets/css/style.css">
  <link rel="alternate" type="application/rss+xml" title="Nick Balestra" href="/feed.xml">
  <link rel="stylesheet" href="/assets/css/highlight.css">
</head>
<body>

  <nav class="main-nav">
    
        <a href='/'> <span class="arrow">‚Üê</span> Home </a>
    

    
    <a href='/about'>About </a>
    
    <a class="cta" href="/feed.xml">Subscribe</a>
</nav>

  

  <section id="wrapper" class="">
    <article class="post">
    <header>
        <h1>Classes and Instantiation Patterns in javaScript</h1>
        <h2 class="headline">July 5, 2015</h2>
    </header>
    <section id="post-body">
        <h2>Any construct that is capable of producing a fleet of similar instances conforming to some interface can be called a Class.</h2>

<p>Without entering into the debate about the OOp aspects of the javaScript language specific to Classes, and if classes/instances truely exists in js, let&#39;s just rely on the above definition, and explore the different patterns available to us for defining Classes and instantiating them.</p>

<hr>

<h3>In general</h3>

<p>Every pattern need to take care of the basics:</p>

<ul>
<li>Create a new object</li>
<li>Assign some properties and methods to it</li>
<li>Return the new decorated object
<br></li>
</ul>

<hr>

<h3>The Functional pattern</h3>

<p>It does just what is suppose to do:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="lineno"> 1</span> <span class="kd">var</span> <span class="nx">FunctionalPattern</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
<span class="lineno"> 2</span>   <span class="c1">// Create a new object</span>
<span class="lineno"> 3</span>   <span class="kd">var</span> <span class="nx">instance</span> <span class="o">=</span> <span class="p">{};</span>
<span class="lineno"> 4</span> 
<span class="lineno"> 5</span>   <span class="c1">// Add methods to it</span>
<span class="lineno"> 6</span>   <span class="nx">instance</span><span class="p">.</span><span class="nx">aMethod</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){};</span>
<span class="lineno"> 7</span>   <span class="nx">instance</span><span class="p">.</span><span class="nx">anotherMethod</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){};</span>
<span class="lineno"> 8</span> 
<span class="lineno"> 9</span>   <span class="c1">// Return the new decorated object</span>
<span class="lineno">10</span>   <span class="k">return</span> <span class="nx">instance</span><span class="p">;</span>
<span class="lineno">11</span> <span class="p">};</span>
<span class="lineno">12</span> 
<span class="lineno">13</span> <span class="c1">// Instantiation Pattern:</span>
<span class="lineno">14</span> <span class="kd">var</span> <span class="nx">instance</span> <span class="o">=</span> <span class="nx">FunctionalPattern</span><span class="p">();</span></code></pre></div>

<h4>Pros &amp; Cons</h4>

<p>The functional pattern have the advantage of returning methods that were defined within the constructor&#39;s lexical scope, therefore creating closures (and making the object constrution pretty clear).
The very same principle that give the functional pattern the closure advantage also define its drawback. As the methods are declared within the the lexical scope of the constructor, instantiating a class via the functional pattern will result in duplicating all its methods, meaning new functions stored in new spots in memory.</p>

<hr>

<h3>The Functional-shared pattern</h3>

<p>Born as an effort to limit the drawbacks of the functional pattern, it moves the methods declaration outside the lexical scope of the class, extending it methods by reference. In this way each istance will have pointers to the same functions without duplicating them:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="lineno"> 1</span> <span class="kd">var</span> <span class="nx">FunctionalSharedPattern</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
<span class="lineno"> 2</span>   <span class="c1">// Create a new object</span>
<span class="lineno"> 3</span>   <span class="kd">var</span> <span class="nx">instance</span> <span class="o">=</span> <span class="p">{};</span>
<span class="lineno"> 4</span> 
<span class="lineno"> 5</span>   <span class="c1">// Add methods to it</span>
<span class="lineno"> 6</span>   <span class="nx">instance</span><span class="p">.</span><span class="nx">aMethod</span> <span class="o">=</span> <span class="nx">functionalSharedMethods</span><span class="p">.</span><span class="nx">aMethod</span><span class="p">;</span>
<span class="lineno"> 7</span>   <span class="nx">instance</span><span class="p">.</span><span class="nx">anotherMethod</span> <span class="o">=</span> <span class="nx">functionalSharedMethods</span><span class="p">.</span><span class="nx">anotherMethod</span><span class="p">;</span>
<span class="lineno"> 8</span> 
<span class="lineno"> 9</span>   <span class="c1">// Return the new decorated object</span>
<span class="lineno">10</span>   <span class="k">return</span> <span class="nx">instance</span><span class="p">;</span>
<span class="lineno">11</span> <span class="p">};</span>
<span class="lineno">12</span> 
<span class="lineno">13</span> <span class="c1">// shared methods where each instance will point to</span>
<span class="lineno">14</span> <span class="kd">var</span> <span class="nx">functionalSharedMethods</span> <span class="o">=</span> <span class="p">{</span>
<span class="lineno">15</span>   <span class="nx">aMethod</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){},</span>
<span class="lineno">16</span>   <span class="nx">anotherMethod</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){},</span>
<span class="lineno">17</span> <span class="p">};</span>
<span class="lineno">18</span> 
<span class="lineno">19</span> <span class="c1">// Instantiation Pattern:</span>
<span class="lineno">20</span> <span class="kd">var</span> <span class="nx">instance</span> <span class="o">=</span> <span class="nx">FunctionalSharedPattern</span><span class="p">();</span></code></pre></div>

<p>...definitely a WET solution.</p>

<blockquote>
<p>WET: Write Everything Twice <em>or</em> We Enjoy Typing</p>
</blockquote>

<p>With the help of a little helper we could refactor the functional-shared pattern to be a little more DRY instead</p>

<blockquote>
<p>DRY: Don&#39;t Reapeat Yourself</p>
</blockquote>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="lineno"> 1</span> <span class="kd">var</span> <span class="nx">FunctionalSharedPattern</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
<span class="lineno"> 2</span>   <span class="c1">// Create a new object</span>
<span class="lineno"> 3</span>   <span class="kd">var</span> <span class="nx">instance</span> <span class="o">=</span> <span class="p">{};</span>
<span class="lineno"> 4</span> 
<span class="lineno"> 5</span>   <span class="c1">// Add methods to it</span>
<span class="lineno"> 6</span>   <span class="nx">extend</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="nx">functionalSharedMethods</span><span class="p">);</span>
<span class="lineno"> 7</span> 
<span class="lineno"> 8</span>   <span class="c1">// Return the new decorated object</span>
<span class="lineno"> 9</span>   <span class="k">return</span> <span class="nx">instance</span><span class="p">;</span>
<span class="lineno">10</span> <span class="p">};</span>
<span class="lineno">11</span> 
<span class="lineno">12</span> <span class="c1">// shared methods where each instance will point to</span>
<span class="lineno">13</span> <span class="kd">var</span> <span class="nx">functionalSharedMethods</span> <span class="o">=</span> <span class="p">{</span>
<span class="lineno">14</span>   <span class="nx">aMethod</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){},</span>
<span class="lineno">15</span>   <span class="nx">anotherMethod</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){},</span>
<span class="lineno">16</span> <span class="p">};</span>
<span class="lineno">17</span> 
<span class="lineno">18</span> <span class="c1">// Basic Extend Helper</span>
<span class="lineno">19</span> <span class="kd">function</span> <span class="nx">extend</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="nx">methods</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno">20</span>   <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">methods</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno">21</span>     <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">instance</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">key</span><span class="p">))</span>
<span class="lineno">22</span>     <span class="nx">instance</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">methods</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
<span class="lineno">23</span>   <span class="p">}</span>
<span class="lineno">24</span> <span class="p">}</span>
<span class="lineno">25</span> 
<span class="lineno">26</span> <span class="c1">// Instantiation Pattern:</span>
<span class="lineno">27</span> <span class="kd">var</span> <span class="nx">instance</span> <span class="o">=</span> <span class="nx">FunctionalSharedPattern</span><span class="p">();</span></code></pre></div>

<h4>Pros &amp; Cons</h4>

<p>The functional-shared pattern solve the cons we saw in the functional pattern.
But, it still have a big drawback: the pointers in each instance are created during the instantiation only, meaning that if we add or edit shared methods those won&#39;t be available to our instances unless we update them (i.e. by invoking the extend helper again on each of our instances.).</p>

<hr>

<h3>The Prototypal pattern</h3>

<p>By now you probably noticing a trend in how this blog post is structured, we are building up a better pattern to solve the drawbacks of the previous one. And this is where the Prototypal pattern come handy. By relying on the prototypal delegation on which javaScript objects obey, it provide a handy way to keep in sync any istance with its class. Long story short: the prototypal pattern allow us to edit, add and remove methods on the Class and automagically have each istance updated accordingly.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="lineno"> 1</span> <span class="kd">var</span> <span class="nx">PrototypalPattern</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
<span class="lineno"> 2</span>   <span class="c1">// Create a new object</span>
<span class="lineno"> 3</span>   <span class="kd">var</span> <span class="nx">instance</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">PrototypalPattern</span><span class="p">.</span><span class="nx">prototype</span><span class="p">);</span>
<span class="lineno"> 4</span> 
<span class="lineno"> 5</span>   <span class="c1">// Methods will be added to the prototype</span>
<span class="lineno"> 6</span> 
<span class="lineno"> 7</span>   <span class="c1">// Return the new decorated object</span>
<span class="lineno"> 8</span>   <span class="k">return</span> <span class="nx">instance</span><span class="p">;</span>
<span class="lineno"> 9</span> <span class="p">};</span>
<span class="lineno">10</span> 
<span class="lineno">11</span> <span class="c1">// PrototypalPattern will delegate to its prototype for methods lookup</span>
<span class="lineno">12</span> <span class="nx">PrototypalPattern</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">aMethod</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){};</span>
<span class="lineno">13</span> <span class="nx">PrototypalPattern</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">anotherMethod</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){};</span>
<span class="lineno">14</span> 
<span class="lineno">15</span> <span class="c1">// Instantiation Pattern:</span>
<span class="lineno">16</span> <span class="kd">var</span> <span class="nx">instance</span> <span class="o">=</span> <span class="nx">PrototypalPattern</span><span class="p">();</span></code></pre></div>

<h4>Pros &amp; Cons</h4>

<p>There are&#39;n much drawbacks with this Pattern, as it solve all our issues we encountered sofar. So, maybe there is not a better way, but just a sweeter way...</p>

<hr>

<h3>Pseudoclassical</h3>

<p>Sometime an advantage could be given by the language itself and its syntactic sugar, and guess what, mr. Pseudoclassical pattern is very very sweet:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="lineno"> 1</span> <span class="kd">var</span> <span class="nx">PseudoclassicalPattern</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
<span class="lineno"> 2</span>   <span class="c1">// Create a new object</span>
<span class="lineno"> 3</span>   <span class="c1">// var this = Object.create(PseudoclassicalPattern.prototype)</span>
<span class="lineno"> 4</span>   <span class="c1">// is automatically done by the interpreter when the function is</span>
<span class="lineno"> 5</span>   <span class="c1">// called with the constructor call</span>
<span class="lineno"> 6</span> 
<span class="lineno"> 7</span>   <span class="k">this</span><span class="p">.</span><span class="nx">aMethod</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){};</span>
<span class="lineno"> 8</span>   <span class="k">this</span><span class="p">.</span><span class="nx">anotherMethod</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){};</span>
<span class="lineno"> 9</span> <span class="p">}</span>
<span class="lineno">10</span> 
<span class="lineno">11</span> <span class="c1">// Instantiation Pattern:</span>
<span class="lineno">12</span> <span class="kd">var</span> <span class="nx">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PseudoclassicalPattern</span><span class="p">();</span></code></pre></div>

<hr>

<h2>Final thoughts and performance</h2>

<p>The clear question we should all ask our self is: which pattern should we use? As for everything the answer is: it depends. It depends on the codebase you are working on and which pattern is most used there, in that case will be a good idea to stick to that. For example the Pseudoclassical is the preferred pattern in MVC‚Äôs such as backbone. Another interesting aspect to take into consideration when deciding which pattern to use could be related to performance, but this is a subject for a another blog post...</p>

<p><strong>Thanks to</strong>:<br>
<a href="http://www.hackreactor.com/">Hack Reactor</a> for being awesome.<br>
<a href="https://twitter.com/cpcrame">Charles Crame</a> for helping in proof reading this post.<br>
<a href="http://www.ryanatkinson.io/author/ryan/">Ryan Atkinson</a> for his inspirational blog.<br></p>

    </section>
</article>
<footer id="post-meta" class="clearfix">
    <a href="http://twitter.com/nickbalestra">
        <img class="avatar" src="/assets/images/profile.png">
        <div>
            <span class="dark">Nick Balestra</span>
            <span>Software engineer</span>
        </div>
    </a>

    <section id="sharing">
        <a class="twitter" href="https://twitter.com/intent/tweet?text=http://nick.balestra.ch/2015/classes-and-instantiation-patterns-in-javascript/ - Classes and Instantiation Patterns in javaScript by @nickbalestra"><span class="icon-twitter"> Tweet</span></a>

<a class="facebook" href="#" onclick="
    window.open(
      'https://www.facebook.com/sharer/sharer.php?u='+encodeURIComponent(location.href),
      'facebook-share-dialog',
      'width=626,height=436');
    return false;"><span class="icon-facebook-rect"> Share</span>
</a>
    </section>
</footer>

<!-- Disqus comments -->

    <section class="disqus">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'nickbalestra';
        var disqus_developer = 0; // developer mode is on
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>


<!-- Archive -->

    <ul id="post-list" class="archive readmore">
        <h3>Read more</h3>
        
            <li>
                <a href="/2015/ES6-classes-and-prototype-based-inheritance/">JS's Prototype-based inheritance and classes demystified<aside class="dates">Oct 15</aside></a>
            </li>
        
            <li>
                <a href="/2015/depthFirst-vs-breadthFirst/">DepthFirst and breadthFirst tree walking<aside class="dates">Oct 10</aside></a>
            </li>
        
            <li>
                <a href="/2015/ES6-Arrows-Arrays-and-Defaults/">‰∏≠ÊñáÊµãËØï<aside class="dates">Oct 05</aside></a>
            </li>
        
            <li>
                <a href="/2015/Installing-Ruby-Gems-Without-Sudo/">Install ruby gems without sudo on OSX<aside class="dates">Oct 04</aside></a>
            </li>
        
            <li>
                <a href="/2015/Installing-Node-Global/">Installing npm packages global on OSX<aside class="dates">Oct 04</aside></a>
            </li>
        
            <li>
                <a href="/2015/pick-your-parsing/">Pick your parsing<aside class="dates">Sep 05</aside></a>
            </li>
        
            <li>
                <a href="/2015/sweetjs-case-macros-for-javascript/">Case based Macros for javaScript<aside class="dates">Aug 29</aside></a>
            </li>
        
            <li>
                <a href="/2015/hrb-sicp-studygroup/">HRB SICP Study group - Getting started with Lisp<aside class="dates">Aug 23</aside></a>
            </li>
        
            <li>
                <a href="/2015/for-loops-the-bad-the-good-the-ugly/">For* Loops: The Bad, The Good And The Ugly<aside class="dates">Aug 08</aside></a>
            </li>
        
            <li>
                <a href="/2015/build-a-simple-api-server-with-node/">Building a simple API server with node<aside class="dates">Jul 26</aside></a>
            </li>
        
            <li>
                <a href="/2015/Backbone-bindings-for-firebase/">Binding Backbone models & collections to Firebase<aside class="dates">Jul 24</aside></a>
            </li>
        
            <li>
                <a href="/2015/classes-and-instantiation-patterns-in-javascript/">Classes and Instantiation Patterns in javaScript<aside class="dates">Jul 05</aside></a>
            </li>
        
            <li>
                <a href="/2015/Prefix-tree-data-structure/">Prefix Tree Data Structure<aside class="dates">Jul 05</aside></a>
            </li>
        
            <li>
                <a href="/2015/javascript-functional-libraries/">JS Functional Programming Libraries<aside class="dates">Jun 13</aside></a>
            </li>
        
            <li>
                <a href="/2015/Kactus/">Kactus for Jekyll<aside class="dates">Jun 11</aside></a>
            </li>
        
            <li>
                <a href="/2015/IIFE/">The IIFE pattern<aside class="dates">Jun 08</aside></a>
            </li>
        
            <li>
                <a href="/2015/truthy-and-falsy/">Truthy and falsy values<aside class="dates">Jun 07</aside></a>
            </li>
        
            <li>
                <a href="/2015/prime-algos/">Trial division, Sieve of Eratosthenes and Factorization Wheel<aside class="dates">May 25</aside></a>
            </li>
        
            <li>
                <a href="/2015/using-every-to-return-some/">Using every() to return some()<aside class="dates">May 15</aside></a>
            </li>
        
            <li>
                <a href="/2015/jekyll-on-github-quick-guide/">Jekyll on Github - Quick guide<aside class="dates">May 10</aside></a>
            </li>
        
            <li>
                <a href="/2015/hackbot-a-js-robot-for-the-browser/">Hackbot - A js robot for the browser<aside class="dates">Jan 26</aside></a>
            </li>
        
            <li>
                <a href="/2015/intro-js-onboarding-api/">Intro.js onboarding API<aside class="dates">Jan 25</aside></a>
            </li>
        
            <li>
                <a href="/2015/javascripts-lexical-scope-hoisting-and-closures-without-mystery/">JavaScript‚Äôs lexical scope, hoisting and closures without mystery<aside class="dates">Jan 17</aside></a>
            </li>
        
    </ul>





  </section>

  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src="/assets/js/main.js"></script>


  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-62842593-1', 'auto');
    ga('send', 'pageview');
  </script>
</body>
</html>
